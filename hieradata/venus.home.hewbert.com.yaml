---
##
## Hiera config for my old server
##
ruby::rubygems_package: 'ruby22-gems'
classes:
  - 'profile::base'
  - 'profile::zfs'
  - 'profile::ssh'
  - 'profile::sudoers'
  - 'profile::puppet'
  - 'profile::plex'
  - 'minecraft'
  - 'profile::smb'
  - 'profile::nginx_server'
  - 'profile::www::home_jbeard'
  - 'profile::www::plex_jbeard'
  - 'profile::transmission'

minecraft::user: 'minecraft'
minecraft::group: 'minecraft'
minecraft::install_base: '/usr/local/minecraft'
minecraft::instance_defaults:
  java_args: '-XX:+UseConcMarkSweepGC -XX:+CMSIncrementalPacing -XX:ParallelGCThreads=4 -XX:+AggressiveOpts'
  plugins_defaults:
    checksum_type: 'md5'
  plugins:
    'WorldEdit':
      # https://dev.bukkit.org/projects/worldedit/files
      source: 'https://addons-origin.cursecdn.com/files/956/525/worldedit-bukkit-6.1.5.jar'
      checksum: '2d57c7887975b583633e3508c3d01ea8'
      plugin_name: 'WorldEdit'
    'Vault':
      # https://dev.bukkit.org/projects/vault
      source: 'https://addons-origin.cursecdn.com/files/894/359/Vault.jar'
      checksum: 'ff7a7b7233146b002727dfa238c8420e'
      plugin_name: 'Vault'
    'EssentialsX':
      # https://www.spigotmc.org/resources/essentialsx.9089/
      # https://ci.drtshock.net/job/EssentialsX/
      source: 'https://ci.drtshock.net/job/EssentialsX/lastStableBuild/artifact/Essentials/target/EssentialsX-2.0.1.jar'
      checksum: '3588a221b5d7d7424b57d6cfbf7b996b'
      plugin_name: 'EssentialsX'
    'EssentialsXAntiBuild':
      source: 'https://ci.drtshock.net/job/EssentialsX/lastStableBuild/artifact/EssentialsAntiBuild/target/EssentialsXAntiBuild-2.0.1.jar'
      checksum: 'a7912369215e53d88ca291278dbff938'
      plugin_name: 'EssentialsXAntiBuild'
    'EssentialsXChat':
      source: 'https://ci.drtshock.net/job/EssentialsX/lastStableBuild/artifact/EssentialsChat/target/EssentialsXChat-2.0.1.jar'
      checksum: '0108193b0fbfb033d8ccdd59c2df5d4e'
      plugin_name: 'EssentialsXChat'
    'EssentialsXGeoIP':
      source: 'https://ci.drtshock.net/job/EssentialsX/lastStableBuild/artifact/EssentialsGeoIP/target/EssentialsXGeoIP-2.0.1.jar'
      checksum: '18398b9c4f1abc49870f812c79bb3f83'
      plugin_name: 'EssentialsXGeoIP'
    'EssentialsXProtect':
      source: 'https://ci.drtshock.net/job/EssentialsX/lastStableBuild/artifact/EssentialsProtect/target/EssentialsXProtect-2.0.1.jar'
      checksum: 'dfe37cc0764ee94f9633a6b3c48ad0a3'
      plugin_name: 'EssentialsXProtect'
    'EssentialsXSpawn':
      source: 'https://ci.drtshock.net/job/EssentialsX/lastStableBuild/artifact/EssentialsSpawn/target/EssentialsXSpawn-2.0.1.jar'
      checksum: '7c2ee690a0ec39c92181f242e624c82e'
      plugin_name: 'EssentialsXSpan'
    'Dynmap':
      # https://dev.bukkit.org/projects/dynmap
      source: 'https://addons-origin.cursecdn.com/files/920/878/dynmap-2.3.jar'
      checksum: 'd6341f5703cf262b9f24a10f58ccde03'
      plugin_name: 'Dynmap'
    'DynmapEssentials':
      # https://dev.bukkit.org/projects/dynmap-essentials
      source: 'https://addons-origin.cursecdn.com/files/912/862/Dynmap-Essentials-0.91.jar'
      checksum: '63f245e417b8c00b6792ba8b1098d062'
      plugin_name: 'DynmapEssentials'
    'DynmapStructures':
      # https://dev.bukkit.org/projects/dynmap-structures
      source: 'https://addons-origin.cursecdn.com/files/956/143/dynmap-structures-1.3.0-all.jar'
      checksum: '065b585a8c2f0df0d2c28bfa8c2e9bc1'
      plugin_name: 'DynmapStructures'
minecraft::instances:
  'survival':
    jar: 'spigot.jar'
    server_properties:
      'spawn-protection': '16'
      'generator-settings': ''
      'force-gamemode': 'false'
      'allow-nether': 'true'
      'gamemode': '0'
      'broadcast-console-to-ops': 'true'
      'enable-query': 'false'
      'player-idle-timeout': '0'
      'difficulty': '1'
      'spawn-monsters': 'true'
      'op-permission-level': '4'
      'announce-player-achievements': 'true'
      'pvp': 'true'
      'snooper-enabled': 'true'
      'level-type': 'DEFAULT'
      'hardcore': 'false'
      'enable-command-block': 'false'
      'max-players': '10'
      'network-compression-threshold': '256'
      'resource-pack-sha1': ''
      'max-world-size': '29999984'
      'server-port': '25566'
      'debug': 'false'
      'server-ip': ''
      'spawn-npcs': 'true'
      'allow-flight': 'false'
      'level-name': 'world'
      'view-distance': '10'
      'resource-pack': ''
      'spawn-animals': 'true'
      'white-list': 'false'
      'generate-structures': 'true'
      'online-mode': 'true'
      'max-build-height': '256'
      'level-seed': ''
      'prevent-proxy-connections': 'false'
      'enable-rcon': 'false'
      'motd': 'Beards Survival Server'
  'creative':
    jar: 'spigot.jar'
    server_properties:
      'spawn-protection': '16'
      'max-tick-time': '60000'
      'generator-settings': ''
      'force-gamemode': 'false'
      'allow-nether': 'true'
      'gamemode': '1'
      'enable-query': 'false'
      'player-idle-timeout': '0'
      'difficulty': '0'
      'spawn-monsters': 'true'
      'op-permission-level': '4'
      'announce-player-achievements': 'false'
      'pvp': 'true'
      'snooper-enabled': 'true'
      'level-type': 'DEFAULT'
      'hardcore': 'false'
      'enable-command-block': 'false'
      'max-players': '10'
      'network-compression-threshold': '256'
      'resource-pack-sha1': ''
      'max-world-size': '29999984'
      'server-port': '25565'
      'debug': 'false'
      'server-ip': ''
      'spawn-npcs': 'true'
      'eula': 'true'
      'allow-flight': 'true'
      'level-name': 'world'
      'view-distance': '10'
      'resource-pack': ''
      'spawn-animals': 'true'
      'white-list': 'false'
      'generate-structures': 'true'
      'online-mode': 'true'
      'max-build-height': '256'
      'level-seed': '-6476032411552918281'
      'prevent-proxy-connections': 'false'
      'enable-rcon': 'false'
      'motd': 'Beards Creative Server'

profile::minecraft::servers:
  'survival':
    dynmap_port: 8123
  'creative':
    dynmap_port: 8124

nginx::config::server_tokens: 'off'
nginx::nginx_vhosts:
  'home.jbeard.org_http':
    www_root: '/var/www/home.jbeard.org'
    server_name:
      - 'home.jbeard.org'
    location_cfg_append:
      'return': '301 http://$server_name$request_uri'

  'home.jbeard.org':
    listen_port: '443'
    ssl: true
    ssl_cert: '/usr/local/etc/letsencrypt/live/home.jbeard.org/fullchain.pem'
    ssl_key: '/usr/local/etc/letsencrypt/live/home.jbeard.org/privkey.pem'
    ssl_ciphers: 'EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH'
    www_root: '/var/www/home.jbeard.org'

  'plex.jbeard.org_http':
    www_root: '/var/www/plex.jbeard.org'
    server_name:
      - 'plex.jbeard.org'
    location_cfg_append:
      'rewrite': '^ https://$server_name$request_uri? permanent'

  'plex.jbeard.org':
    listen_port: '443'
    proxy: 'http://localhost:32400'
    auth_basic: 'Plex'
    auth_basic_user_file: '/usr/local/etc/transmission/transmission.access'
    ssl: true
    ssl_cert: '/usr/local/etc/letsencrypt/live/plex.jbeard.org/fullchain.pem'
    ssl_key: '/usr/local/etc/letsencrypt/live/plex.jbeard.org/privkey.pem'
    ssl_ciphers: 'EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH'

  't.jbeard.org_http':
    www_root: '/var/www/t.jbeard.org'
    server_name:
      - 't.jbeard.org'
    location_cfg_append:
      'rewrite': '^ https://$server_name$request_uri? permanent'

  't.jbeard.org':
    listen_port: '443'
    proxy: 'http://localhost:9091'
    auth_basic: 'Transmission'
    auth_basic_user_file: '/usr/local/etc/transmission/transmission.access'
    ssl: true
    ssl_cert: '/usr/local/etc/letsencrypt/live/t.jbeard.org/fullchain.pem'
    ssl_key: '/usr/local/etc/letsencrypt/live/t.jbeard.org/privkey.pem'
    ssl_ciphers: 'EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH'

nginx::nginx_locations:
  'home-well-known':
    location: '/.well-known'
    vhost: 'home.jbeard.org_http'
    www_root: '/var/www/home.jbeard.org'

  'plex-well-known':
    location: '/.well-known'
    vhost: 'plex.jbeard.org_http'
    www_root: '/var/www/plex.jbeard.org'

  't-well-known':
    location: '/.well-known'
    vhost: 't.jbeard.org_http'
    www_root: '/var/www/t.jbeard.org'

  '/transmission':
    proxy: 'http://localhost:9091'
    vhost: 'home.jbeard.org'
    auth_basic: 'Transmission'
    auth_basic_user_file: '/usr/local/etc/transmission/transmission.access'
    ssl: true
    ssl_only: true

  'creative-dynmap':
    location: '/dynmap/creative/'
    vhost: 'home.jbeard.org'
    proxy: 'http://127.0.0.1:8124/'
    proxy_redirect: 'default'
    ssl: true
    ssl_only: true
    auth_basic: 'Creative Dynmap'
    auth_basic_user_file: '/usr/local/etc/transmission/transmission.access'

  'survival-dynmap':
    location: '/dynmap/survival/'
    vhost: 'home.jbeard.org'
    proxy: 'http://127.0.0.1:8123/'
    proxy_redirect: 'default'
    ssl: true
    ssl_only: true
    auth_basic: 'Survival Dynmap'
    auth_basic_user_file: '/usr/local/etc/transmission/transmission.access'

# -------------------------------------------------------------------
# Letsencrypt
# -------------------------------------------------------------------
letsencrypt::package_command: 'certbot'
letsencrypt::install_method: 'package'
letsencrypt::package_name: 'py27-certbot'

profile::letsencrypt::certonly_defaults:
  plugin: 'webroot'
  manage_cron: true
  cron_success_command: '/usr/sbin/service nginx restart'

profile::letsencrypt::domains:
  'plex.jbeard.org':
    webroot_paths:
      - '/var/www/plex.jbeard.org'
  'home.jbeard.org':
    webroot_paths:
      - '/var/www/home.jbeard.org'
  't.jbeard.org':
    webroot_paths:
      - '/var/www/t.jbeard.org'
