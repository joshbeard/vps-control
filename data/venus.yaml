---
##
## Hiera config for my old server
##
ruby::rubygems_package: 'ruby22-gems'
classes:
  - 'profile::base'
  - 'profile::zfs'
  - 'profile::ssh'
  - 'profile::sudoers'
  - 'profile::puppet'
  - 'profile::plex'
  - 'minecraft'
  - 'profile::nginx_server'
  - 'profile::letsencrypt'
  - 'profile::transmission'

# Check in to https://yivesmirror.com/downloads/paperspigot
minecraft::user: 'minecraft'
minecraft::group: 'minecraft'
minecraft::install_base: '/store/minecraft'
minecraft::instance_defaults:
  java_args: '-XX:+UseConcMarkSweepGC -XX:+CMSIncrementalPacing -XX:ParallelGCThreads=4 -XX:+AggressiveOpts'
  plugins_defaults:
    checksum_type: 'md5'
  plugins:
    'WorldEdit':
      # https://dev.bukkit.org/projects/worldedit/files
      source: 'https://addons.cursecdn.com/files/2460/562/worldedit-bukkit-6.1.7.3.jar'
      checksum: 'a12733e7e042a4d9b095dc6f95057698'
      plugin_name: 'WorldEdit'
    'Vault':
      # https://dev.bukkit.org/projects/vault
      source: 'https://addons-origin.cursecdn.com/files/894/359/Vault.jar'
      checksum: 'ff7a7b7233146b002727dfa238c8420e'
      plugin_name: 'Vault'
    'EssentialsX':
      # https://www.spigotmc.org/resources/essentialsx.9089/
      # https://ci.drtshock.net/job/EssentialsX/
      source: 'https://ci.drtshock.net/job/EssentialsX/lastStableBuild/artifact/Essentials/target/EssentialsX-2.0.1.jar'
      checksum: '721804a3ed308477e03c8b395aeebbcc'
      plugin_name: 'EssentialsX'
    'EssentialsXAntiBuild':
      source: 'https://ci.drtshock.net/job/EssentialsX/lastStableBuild/artifact/EssentialsAntiBuild/target/EssentialsXAntiBuild-2.0.1.jar'
      checksum: '46cbacc7c1551a9c6274e7860d009669'
      plugin_name: 'EssentialsXAntiBuild'
    'EssentialsXChat':
      source: 'https://ci.drtshock.net/job/EssentialsX/lastStableBuild/artifact/EssentialsChat/target/EssentialsXChat-2.0.1.jar'
      checksum: 'b541ef54081d7724b6cbfa5aa6c2cdda'
      plugin_name: 'EssentialsXChat'
    'EssentialsXGeoIP':
      source: 'https://ci.drtshock.net/job/EssentialsX/lastStableBuild/artifact/EssentialsGeoIP/target/EssentialsXGeoIP-2.0.1.jar'
      checksum: '08edbeb3ddfa0231ca1f2d9fcff72131'
      plugin_name: 'EssentialsXGeoIP'
    'EssentialsXProtect':
      source: 'https://ci.drtshock.net/job/EssentialsX/lastStableBuild/artifact/EssentialsProtect/target/EssentialsXProtect-2.0.1.jar'
      checksum: '35f46e223e60cfd049687e0b259008a5'
      plugin_name: 'EssentialsXProtect'
    'EssentialsXSpawn':
      source: 'https://ci.drtshock.net/job/EssentialsX/lastStableBuild/artifact/EssentialsSpawn/target/EssentialsXSpawn-2.0.1.jar'
      checksum: '1486f583b5763e9eebf6ff197e62a2f6'
      plugin_name: 'EssentialsXSpan'
    'Dynmap':
      # https://dev.bukkit.org/projects/dynmap
      source: 'https://addons-origin.cursecdn.com/files/2431/572/dynmap-2.5.jar'
      checksum: '328fa81e6c5ccb22ce2d44f2c1c7f114'
      plugin_name: 'Dynmap'
    'DynmapEssentials':
      # https://dev.bukkit.org/projects/dynmap-essentials
      source: 'https://addons-origin.cursecdn.com/files/912/862/Dynmap-Essentials-0.91.jar'
      checksum: '63f245e417b8c00b6792ba8b1098d062'
      plugin_name: 'DynmapEssentials'
    'DynmapStructures':
      # https://dev.bukkit.org/projects/dynmap-structures
      source: 'https://addons-origin.cursecdn.com/files/2407/445/dynmap-structures-1.4.0-all.jar'
      checksum: 'e2203ebb894ff4fa37e990a5914642ca'
      plugin_name: 'DynmapStructures'
minecraft::instances:
  'survival':
    jar: 'paperclip.jar'
    source: 'https://ci.destroystokyo.com/job/PaperSpigot/lastStableBuild/artifact/paperclip-1220.jar'
    server_properties:
      'spawn-protection': '16'
      'generator-settings': ''
      'force-gamemode': 'false'
      'allow-nether': 'true'
      'gamemode': '0'
      'broadcast-console-to-ops': 'true'
      'enable-query': 'false'
      'player-idle-timeout': '0'
      'difficulty': '1'
      'spawn-monsters': 'true'
      'op-permission-level': '4'
      'pvp': 'true'
      'snooper-enabled': 'true'
      'level-type': 'DEFAULT'
      'hardcore': 'false'
      'enable-command-block': 'false'
      'max-players': '10'
      'network-compression-threshold': '256'
      'resource-pack-sha1': ''
      'max-world-size': '29999984'
      'server-port': '25566'
      'debug': 'false'
      'server-ip': ''
      'spawn-npcs': 'true'
      'allow-flight': 'false'
      'level-name': 'world'
      'view-distance': '10'
      'resource-pack': ''
      'spawn-animals': 'true'
      'white-list': 'false'
      'generate-structures': 'true'
      'online-mode': 'true'
      'max-build-height': '256'
      'level-seed': ''
      'prevent-proxy-connections': 'false'
      'enable-rcon': 'false'
      'motd': 'Beards Survival Server'
  'creative':
    jar: 'paperclip.jar'
    source: 'https://ci.destroystokyo.com/job/PaperSpigot/lastStableBuild/artifact/paperclip-1220.jar'
    server_properties:
      'spawn-protection': '16'
      'max-tick-time': '60000'
      'generator-settings': ''
      'force-gamemode': 'false'
      'allow-nether': 'true'
      'gamemode': '1'
      'enable-query': 'false'
      'player-idle-timeout': '0'
      'difficulty': '0'
      'spawn-monsters': 'true'
      'op-permission-level': '4'
      'pvp': 'true'
      'snooper-enabled': 'true'
      'level-type': 'DEFAULT'
      'hardcore': 'false'
      'enable-command-block': 'false'
      'max-players': '10'
      'network-compression-threshold': '256'
      'resource-pack-sha1': ''
      'max-world-size': '29999984'
      'server-port': '25565'
      'debug': 'false'
      'server-ip': ''
      'spawn-npcs': 'true'
      'eula': 'true'
      'allow-flight': 'true'
      'level-name': 'world'
      'view-distance': '10'
      'resource-pack': ''
      'spawn-animals': 'true'
      'white-list': 'false'
      'generate-structures': 'true'
      'online-mode': 'true'
      'max-build-height': '256'
      'level-seed': '-6476032411552918281'
      'prevent-proxy-connections': 'false'
      'enable-rcon': 'false'
      'motd': 'Beards Creative Server'

profile::minecraft::servers:
  'survival':
    dynmap_port: 8123
  'creative':
    dynmap_port: 8124

nginx::config::server_tokens: 'off'
nginx::nginx_servers:
  'home.jbeard.org_http':
    www_root: '/var/www/home.jbeard.org'
    server_name:
      - 'home.jbeard.org'
    location_cfg_append:
      'return': '301 http://$server_name$request_uri'

  'home.jbeard.org':
    listen_port: 443
    ssl: true
    ssl_cert: '/usr/local/etc/letsencrypt/live/home.jbeard.org/fullchain.pem'
    ssl_key: '/usr/local/etc/letsencrypt/live/home.jbeard.org/privkey.pem'
    ssl_ciphers: 'EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH'
    www_root: '/var/www/home.jbeard.org'

  'plex.jbeard.org_http':
    www_root: '/var/www/plex.jbeard.org'
    server_name:
      - 'plex.jbeard.org'
    location_cfg_append:
      'rewrite': '^ https://$server_name$request_uri? permanent'

  'plex.jbeard.org':
    listen_port: 443
    proxy: 'http://localhost:32400'
    auth_basic: 'Plex'
    auth_basic_user_file: '/usr/local/etc/transmission/transmission.access'
    ssl: true
    ssl_cert: '/usr/local/etc/letsencrypt/live/plex.jbeard.org/fullchain.pem'
    ssl_key: '/usr/local/etc/letsencrypt/live/plex.jbeard.org/privkey.pem'
    ssl_ciphers: 'EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH'

  't.jbeard.org_http':
    www_root: '/var/www/t.jbeard.org'
    server_name:
      - 't.jbeard.org'
    location_cfg_append:
      'rewrite': '^ https://$server_name$request_uri? permanent'

  't.jbeard.org':
    listen_port: 443
    proxy: 'http://localhost:9091'
    auth_basic: 'Transmission'
    auth_basic_user_file: '/usr/local/etc/transmission/transmission.access'
    ssl: true
    ssl_cert: '/usr/local/etc/letsencrypt/live/t.jbeard.org/fullchain.pem'
    ssl_key: '/usr/local/etc/letsencrypt/live/t.jbeard.org/privkey.pem'
    ssl_ciphers: 'EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH'

nginx::nginx_locations:
  'home-well-known':
    location: '/.well-known'
    server: 'home.jbeard.org_http'
    www_root: '/var/www/le_webroot/home.jbeard.org'

  'plex-well-known':
    location: '/.well-known'
    server: 'plex.jbeard.org_http'
    www_root: '/var/www/le_webroot/plex.jbeard.org'

  't-well-known':
    location: '/.well-known'
    server: 't.jbeard.org_http'
    www_root: '/var/www/le_webroot/t.jbeard.org'

  '/transmission':
    proxy: 'http://localhost:9091'
    server: 'home.jbeard.org'
    auth_basic: 'Transmission'
    auth_basic_user_file: '/usr/local/etc/transmission/transmission.access'
    ssl: true
    ssl_only: true

  'creative-dynmap':
    location: '/dynmap/creative/'
    server: 'home.jbeard.org'
    proxy: 'http://127.0.0.1:8124/'
    proxy_redirect: 'default'
    ssl: true
    ssl_only: true

  'survival-dynmap':
    location: '/dynmap/survival/'
    server: 'home.jbeard.org'
    proxy: 'http://127.0.0.1:8123/'
    proxy_redirect: 'default'
    ssl: true
    ssl_only: true

# -------------------------------------------------------------------
# Letsencrypt
# -------------------------------------------------------------------
letsencrypt::package_command: 'certbot'
letsencrypt::install_method: 'package'
letsencrypt::package_name: 'py27-certbot'

profile::letsencrypt::certonly_defaults:
  plugin: 'webroot'
  manage_cron: false

profile::letsencrypt::domains:
  'plex.jbeard.org':
    webroot_paths:
      - '/var/www/le_webroot/plex.jbeard.org'
  'home.jbeard.org':
    webroot_paths:
      - '/var/www/le_webroot/home.jbeard.org'
  't.jbeard.org':
    webroot_paths:
      - '/var/www/le_webroot/t.jbeard.org'
